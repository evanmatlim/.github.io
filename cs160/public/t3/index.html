<!DOCTYPE html>
<html>
  <head>
    <title>Task 3</title>

    <link
      href="https://fonts.googleapis.com/css?family=Fira+Sans"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/vendor/bootstrap/css/bootstrap.css"
    />
    <script src="/vendor/bootstrap/js/bootstrap.bundle.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/main.css" />

    <style>
      section {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-gap: 1rem;
        grid-auto-rows: 12rem;
      }

      section img {
        /* cover */
        width: 100%;
        height: 100%;
        /* height same as width: */
        object-fit: cover;

        border-radius: 0.3rem;
        box-shadow: 0 0 1rem -0.5rem rgba(0, 0, 0, 0.8);
      }

      section {
        margin-bottom: 2rem;
      }

      .upload-form {
        margin-bottom: 2rem;

        & form {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
        }
      }

      #loading {
        width: 90px;
        height: 100%;
        /* background-color: blue; */
        font-family: "Fira Sans";
        font-size: large;
        display: flex;
        flex-direction: column;
        justify-content: end;
      }

      .loading-container {
        width: 100%;
        height: 40px;
        display: none;
        flex-direction: row;
        justify-content: center;
      }

    </style>
  </head>

  <body>
    <div class="container">
      <header>
        <h1>Holiday pics</h1>
      </header>

      <div class="upload-form">
        <form>
          <input type="file" name="file" class="form-control" />
          <input type="submit" value="Add" class="btn btn-primary" />
        </form>
        <div class="loading-container"><div id="loading"></div></div>
      </div>

      <!-- YOUR CODE HERE: Edit these headers to use the names of the holidays you've chosen. -->
      <h2>Christmas</h2>
      <section id="Christmas"></section>

      <h2>Thanksgiving</h2>
      <section id="Thanksgiving"></section>

      <h2>Halloween</h2>
      <section id="Halloween"></section>

      <h2>Uncategorized</h2>
      <section id="uncategorized"></section>
    </div>

    <script>
      const addToGallery = (src, sectionId) => {
        loadingElement.innerHTML = "Done!";
        deactivateLoading();
        const img = document.createElement("img");
        img.src = src;

        // console.log(sectionId);
        let section = document.getElementById(sectionId);
        if (section === null) {
          section = document.getElementById("uncategorized");
        }
        section.appendChild(img);
      };

      document
        .querySelector("form")
        .addEventListener("submit", async (event) => {
          event.preventDefault();
          const file = document.querySelector('input[type="file"]').files[0];
          const fileReader = new FileReader();
          fileReader.onload = async (readEvent) => {
            const dataUrl = readEvent.target.result;

            // YOUR CODE HERE
            activateLoading();
            // import fetch from 'node-fetch'; // for node.js
            const response = await fetch(
              'https://noggin.rea.gent/valid-falcon-3427',
              {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  Authorization: 'Bearer rg_v1_mxnwbglu44mrk05lan7rnpgfae7uj8typ7g0_ngk',
                },
                body: JSON.stringify({
                  // fill variables here.
                  // You can use an external URL or a data URL here.
                  "image": dataUrl,
                }),
              }
            ).then(response => response.text());

            addToGallery(dataUrl, response);
          };

          fileReader.readAsDataURL(file);
        });

      function activateLoading() {
        isLoading = true;
        loadingAnimation();
      }

      function deactivateLoading() {
        isLoading = false;
      }

      let loadingState = 0;
      let loadingTexts = ["Loading", "Loading.", "Loading..", "Loading..."];
      let isLoading = false;
      let loadingElement = document.getElementById("loading");

      const pause = ms => new Promise(resolve => setTimeout(resolve, ms));
      async function loadingAnimation() {
        loadingState = 0;
        document.querySelector(".loading-container").style.display = "flex";
        while(isLoading) {
          loadingElement.innerHTML = loadingTexts[loadingState];
          loadingState = (loadingState + 1) % 4;
          await pause(250);
        }
        await pause(1800);
        loadingElement.innerHTML = "";
        document.querySelector(".loading-container").style.display = "none";
      }

      // Some example images:
      // We've chosen Valentine's day-themed images for this example, but you can swap them out or remove them if you choose another holiday!
      // Likewise for the other holidays.
      addToGallery("/images/christmas1.png", "Christmas");
      addToGallery("/images/christmas2.jpeg", "Christmas");
      addToGallery("/images/thanksgiving1.jpeg", "Thanksgiving");
      addToGallery("/images/thanksgiving2.png", "Thanksgiving");
      addToGallery("/images/halloween1.png", "Halloween");
      addToGallery("/images/halloween2.png", "Halloween");
      // addToGallery("/images/izumi-jS4UNRCMqUk-unsplash.jpg", "holiday-1");
      // addToGallery("/images/laura-ockel-zAOBpEE_vV4-unsplash.jpg", "holiday-1");
      // addToGallery("/images/brooke-lark-pXEsx3kRuNc-unsplash.jpg", "holiday-1");

      // // Arbor Day
      // addToGallery(
      //   "/images/andrew-shelley-Hzbq4de24kQ-unsplash.jpg",
      //   "holiday-2"
      // );
      // addToGallery(
      //   "/images/vitor-monthay-EkEdHarUPTs-unsplash.jpg",
      //   "holiday-2"
      // );

      // // Halloween
      // addToGallery(
      //   "/images/erica-marsland-huynh-DLxOLOQPNAc-unsplash.jpg",
      //   "holiday-3"
      // );
      // addToGallery(
      //   "/images/sabina-music-rich-OJy0JHnoUZQ-unsplash.jpg",
      //   "holiday-3"
      // );
      // addToGallery("/images/eric-deeran-L2CPP72_uUg-unsplash.jpg", "holiday-3");
      // addToGallery("/images/simom-caban-ZKrEJMhEsr8-unsplash.jpg", "holiday-3");

      // // Uncategorized
      // addToGallery(
      //   "/images/ray-hennessy-gdTxVSAE5sk-unsplash.jpg",
      //   "uncategorized"
      // );
    </script>
  </body>
</html>
